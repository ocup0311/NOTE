##### <!-- ref 放置區 -->

[第 7 週：sql]: https://youtu.be/zrCLRC3Ci1c
[多推薦 mysql gui]: http://sequelpro.com/

# [第 7 週：SQL]

## # 工具

- [多推薦 MySQL GUI]

## 0. Q & A

- 輸入`sqlite> .schema`後，才出現`.db`檔案 (40:00)
- 為什麼可以排列整齊？(46:30)

  - 可對以下進行設定

    ```shell
    sqlite> .mode column
    sqlite> .header on
    sqlite> .width 10 20 10
    ```

- 如何重複使用暱稱？(51:25)

  - EX. JOIN 時可用

    <mark>TODO:</mark> 範例再做確認

    ```sql
    SELECT employees.name, employees.age, departments.name
    FROM employees AS e
    JOIN departments AS d ON e.department_id = d.id
    ORDER BY d.name;
    ```

- 多個 Table 是什麼意思？(1:43:00)

  - 先將多個 Table 相乘展開，再於大表查詢

  ```sql
  SELECT title FROM people, stars, shows
  WHERE people.id = stars.person_id
  AND stars.show_id = shows.id
  AND name = 'Steve';
  ```

- index 是 B-Tree (1:49:00)

  - <mark>TODO:</mark> 再研究 B-Tree 的做法

- python print 用 `f` 比用 `?` 更容易受到駭客攻擊？

  - <mark>TODO:</mark> 再研究 ? 的做法

## 1. SQL 語法

<!-- 基本關鍵字 -->

- 基本關鍵字

  - C：`CREATE` `INSERT`
  - R：`SELECT`
  - U：`UPDATE`
  - D：`DELETE` `DROP`

<!-- 常用關鍵字 -->

- 常用關鍵字

  - `AVG`, `COUNT`, `DISTINCT`, `LOWER`, `MAX`, `MIN`, `UPPER`...

- 常用修飾

  - `WHERE`, `LIKE`, `ORDER BY`, `LIMIT`, `GROUP BY`...

<!-- 建立 TABLE -->

- 建立 TABLE

  ```sql
  # EX.
  CREATE TABLE employees (
      id INTEGER PRIMARY KEY,
      name TEXT,
      age INTEGER,
      position TEXT
  );

  CREATE TABLE favorites (
    Timestamp TEXT,
    language TEXT,
    problem TEXT
  );
  ```

<!-- 新增 -->

- 新增

  - 新增一筆資料到一個 Table

  ```sql
  # EX. 新增 {name:'Bob', age:37, position:'Engineer'} 到 TABLE employees
  INSERT INTO employees (name, age, position)
  VALUES ('Bob', 37, 'Engineer');

  # 如果允許 NULL 可以省略一些欄位
  # EX. 新增 {name:'Bob', age:37} 到 TABLE employees
  INSERT INTO employees (name, age)
  VALUES ('Bob', 37);
  ```

<!-- 查詢 -->

- 查詢

  - 查詢一個 Table 中所有資料 (`*`)

    ```sql
    SELECT * FROM employees;
    ```

  - 查詢一個 Table 中某個欄位的所有資料

    ```sql
    SELECT name FROM employees;
    ```

<!-- 常用功能 -->

- 常用功能

  - `COUNT`

    ```sql
    # EX. 查詢 employees 中，計算總共有幾筆資料
    sqlite> SELECT COUNT(*) FROM employees;
    6

    # EX. 查詢 employees Table 中，計算有幾筆資料有 age 欄位
    sqlite> SELECT COUNT(age) FROM employees;
    4
    ```

  - `DISTINCT`

    ```sql
    # EX. 查詢列出 employees Table 中，position 欄位的所有實例
    sqlite> SELECT DISTINCT(position) FROM employees;
    Manager
    Engineer
    ```

  - 可以結合使用

    ```sql
    # EX. 查詢 employees Table 中，計算 position 欄位的所有實例數目
    sqlite> SELECT COUNT(DISTINCT(position)) FROM employees;
    + ------------------------- +
    | COUNT(DISTINCT(position)) |
    + ------------------------- +
    | 2                         |
    + ------------------------- +
    ```

  - 可以調整輸出時 Header 的暱稱

    ```sql
    # EX. 將 COUNT(DISTINCT(position)) 取一個暱稱 n
    sqlite> SELECT COUNT(DISTINCT(position)) AS n FROM employees;
    + - +
    | n |
    + - +
    | 2 |
    + - +
    ```

- 特殊關鍵字
  - `BEGIN TRANSACTION`, `COMMIT`, `ROLLBACK`

## 2. SQLite

- 輕量級的嵌入式關聯式資料庫管理系統

  ![](https://i.imgur.com/L8Hm9Xc.png)

- 簡易建立一個 SQLite

  ```shell
  # 建立 DB 並進入 sqlite 模式
  $ sqlite3 dbName.db
  sqlite>
  ```

- 查詢已存在的 schema

  ```shell
  # show 出所有已存在的 schema，包含空白縮排ＸＤ
  sqlite> .schema
  ```

  - 範例
    ![](https://i.imgur.com/MkhDC7L.png)

- Data type
  - `BLOB`, `INTEGER`, `NUMERIC`, `REAL`, `TEXT`

## 3. 注意

- 末尾需加上分號`;` (可能有些 DBMS 可以不加分號)
- 如`SELECT`等 SQL 關鍵字，並不一定要大寫，但好習慣是保持大寫，以便做區分閱讀
- 有手動新增較大 id 的資料，下次自動產生 id，會在當前最大 id 的下一號

  - EX. 手動新增 id:9 ，下次自動生成的會排在 id:10，即使中間有空號
    ![](https://i.imgur.com/XJtACbJ.png)
    ![](https://i.imgur.com/OWmnXvM.png)

- `UPDATE`, `DELETE`沒設定查詢條件時，會將整個 Table 的所有資料進行操作

- SQL Table 若想要多對多關係，則需要一個中間 Table，因為沒有像是 array 這種 data type

  ```sql
  # EX. 以 stars 來達成 shows ＆ people 的 "多對多" 關係
  CREATE TABLE shows (
      id INTEGER,
      title TEXT NOT NULL,
      year NUMERIC,
      PRIMARY KEY(id)
  );
  CREATE TABLE stars (
      show_id INTEGER NOT NULL,
      person_id INTEGER NOT NULL,
      FOREIGN KEY(show_id) REFERENCES shows(id),
      FOREIGN KEY(person_id) REFERENCES people(id),
  );
  CREATE TABLE people (
      id INTEGER,
      name TEXT NOT NULL,
      PRIMARY KEY(id)
  );
  ```
