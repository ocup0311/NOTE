## [584. Find Customer Referee](https://leetcode.com/problems/find-customer-referee/description/)

- 我的解答：

  - 使用 index(referee_id, name)

  ```sql
  SELECT name
  FROM Customer
  WHERE referee_id <> 2 OR referee_id IS NULL;
  ```

- 注意：

  - `<>` 與 `!=` 相同效果，前者較原生 sql
  - 因為 `NULL` 無法比較數值，一律返回 NULL 而不是 TRUE or FLASE，所以此種情況必須另外處理 NULL

- 使用 `IFNULL` 或 `COALESCE`

  - 簡介：`IFNULL` 判斷為 NULL 後回傳替代值。`COALESCE` 回傳第一個非 NULL 值
  - 此時使用 IFNULL 即可，而不需要用到 COALESCE
  - 一些情況替代為 -1 比 0 可能更好 (0 可能常被賦予特殊用途)
  - 如果有適合的 index 時，應該避免在 WHERE 使用 function，以免 index 失去作用
  - 也可以單獨為其做一個 Functional Index (但是只能單獨一個函式結果，而不能與 name 做成 Composite Index)

  ```sql
  SELECT name
  FROM Customer
  WHERE IFNULL(referee_id, -1) <> 2;

  SELECT name
  FROM Customer
  WHERE COALESCE(referee_id, -1) <> 2;
  ```

- 更多解答：

  - `UNION ALL`

    - 可以讓兩個判斷條件，各自使用 index
    - 注意可能有重複的名字，所以要用 UNION ALL

    ```sql
    SELECT name FROM Customer WHERE referee_id <> 2
    UNION ALL
    SELECT name FROM Customer WHERE referee_id IS NULL;
    ```

  - `CASE`

    - 此方法也可能會導致無法使用 index
    - 可以在一次查詢中，同時對兩個條件做判斷

    ```sql
    SELECT name
    FROM Customer
    WHERE CASE
        WHEN referee_id IS NULL THEN 1
        WHEN referee_id <> 2 THEN 1
        ELSE 0
    END = 1;
    ```

### 測試

```sql
SELECT k2
FROM table2
WHERE IFNULL(k7, -1) <> 7;

SELECT k2
FROM table2
WHERE CASE
    WHEN k7 IS NULL THEN 1
    WHEN k7 <> 7 THEN 1
    ELSE 0
END = 1;

SELECT k2 FROM table2 WHERE k7 <> 7
UNION ALL
SELECT k2 FROM table2 WHERE k7 IS NULL;

SELECT k2
FROM table2
WHERE COALESCE(k7, -1) <> 7;
```
